var WPEMRestAPIAdmin={init:function(){var e;function a(){"selected"===jQuery('input[name="event_show_by"]:checked').val()?(jQuery("#select-events-row").show(),jQuery("#select_events").chosen("destroy").chosen()):jQuery("#select-events-row").hide()}jQuery("#update_api_key").on("click",WPEMRestAPIAdmin.actions.saveApiKey),jQuery("select#key_user").chosen(),jQuery("select#event_id").chosen(),jQuery("#select_events").chosen(),jQuery("input#date_expires").datepicker({dateFormat:"yy-mm-dd",minDate:0}),jQuery("table#app-branding-color-dark").hide(),jQuery(".wpem-app-branding-mode .app-branding-mode .wpem-light-mode").click(function(){jQuery(".wpem-app-branding-mode").removeClass("wpem-dark-mode").addClass("wpem-light-mode"),jQuery("table#app-branding-color").show(),jQuery("table#app-branding-color-dark").hide()}),jQuery(".wpem-app-branding-mode .app-branding-mode .wpem-dark-mode").click(function(){jQuery("table#app-branding-color").hide(),jQuery("table#app-branding-color-dark").show(),jQuery(".wpem-app-branding-mode").removeClass("wpem-light-mode").addClass("wpem-dark-mode")}),jQuery("#update_app_branding").on("click",WPEMRestAPIAdmin.actions.saveAppBranding),jQuery(".wpem-colorpicker").wpColorPicker({defaultColor:!0,change:function(a,r){a.target,clearTimeout(e),e=setTimeout(function(){WPEMRestAPIAdmin.actions.changeBrightness(a,r.toString())},500)}}),a(),jQuery('input[name="event_show_by"]').change(function(){a()}),jQuery(".wp_event_manager_upload_file_button").on("click",function(e){e.preventDefault();var a=jQuery(this).closest(".file_url").find("#wpem_rest_api_app_logo");console.log(a);var r=wp.media({title:"Select or Upload Image",button:{text:"Use this image"},multiple:!1}).on("select",function(){var e=r.state().get("selection").first().toJSON();a.val(e.url)}).open()})},actions:{saveApiKey:function(e){e.preventDefault();var a=this;jQuery("#api_key_loader").show(),jQuery("#update_api_key").attr("disabled",!0),jQuery.ajax({type:"POST",url:wpem_rest_api_admin.ajaxUrl,data:{action:"save_rest_api_keys",security:wpem_rest_api_admin.save_api_nonce,key_id:jQuery("#key_id").val(),description:jQuery("#key_description").val(),user:jQuery("#key_user").val(),permissions:jQuery("#key_permissions").val(),event_id:jQuery("#event_id").val(),date_expires:jQuery("#date_expires").val(),restrict_check_in:jQuery('input[name="restrict_check_in"]').attr("checked")?0:1,event_show_by:jQuery('input[name="event_show_by"]:checked').val(),select_events:jQuery("#select_events").val()||[],mobile_menu:jQuery('input[name="mobile_menu[]"]:checked').map(function(){return this.value}).get()},beforeSend:function(e){},success:function(e){e.success?(jQuery("h2, h3",a.el).first().html('<div class="wpem-api-message updated"><p>'+e.data.message+"</p></div>"),0<e.data.consumer_key.length&&0<e.data.consumer_secret.length?(jQuery("#api-keys-options",a.el).parent().remove(),jQuery("p.submit",a.el).empty().append(e.data.revoke_url),jQuery("#key-fields p.submit",a.el).before(wp.template("api-keys-template")({consumer_key:e.data.consumer_key,consumer_secret:e.data.consumer_secret,app_key:e.data.app_key}))):(jQuery("#key_description",a.el).val(e.data.description),jQuery("#key_user",a.el).val(e.data.user_id),jQuery("#key_permissions",a.el).val(e.data.permissions),jQuery('input[name="event_show_by"][value="'+e.data.event_show_by+'"]').prop("checked",!0),jQuery("#select_events").val(e.data.selected_events).trigger("chosen:updated"))):jQuery("h2, h3",a.el).first().append('<div class="wpem-api-message error"><p>'+e.errorThrown+"</p></div>"),e.data.mobile_menu&&(jQuery('input[name="mobile_menu[]"]').prop("checked",!1),e.data.mobile_menu.forEach(function(e){jQuery('input[name="mobile_menu[]"][value="'+e+'"]').prop("checked",!0)}))},error:function(e,r,n){jQuery("h2, h3",a.el).first().append('<div class="wpem-api-message error"><p>'+n+"</p></div>")},complete:function(e,a){jQuery("#api_key_loader").hide(),jQuery("#update_api_key").attr("disabled",!1)}})},saveAppBranding:function(e){e.preventDefault();var a="",r=jQuery("#app-branding-color").is(":visible"),n=jQuery("#app-branding-color-dark").is(":visible");r?a="light":n&&(a="dark"),jQuery.ajax({type:"POST",url:wpem_rest_api_admin.ajaxUrl,data:{action:"save_app_branding",security:wpem_rest_api_admin.save_app_branding_nonce,wpem_primary_color:jQuery('input[name="wpem_primary_color"]').val(),wpem_success_color:jQuery('input[name="wpem_success_color"]').val(),wpem_info_color:jQuery('input[name="wpem_info_color"]').val(),wpem_warning_color:jQuery('input[name="wpem_warning_color"]').val(),wpem_danger_color:jQuery('input[name="wpem_danger_color"]').val(),wpem_primary_dark_color:jQuery('input[name="wpem_primary_dark_color"]').val(),wpem_success_dark_color:jQuery('input[name="wpem_success_dark_color"]').val(),wpem_info_dark_color:jQuery('input[name="wpem_info_dark_color"]').val(),wpem_warning_dark_color:jQuery('input[name="wpem_warning_dark_color"]').val(),wpem_danger_dark_color:jQuery('input[name="wpem_danger_dark_color"]').val(),active_mode:a},beforeSend:function(e){},success:function(e){jQuery(".wpem-branding-status").html('<div class="wpem-api-message updated"><p>'+e.data.message+"</p></div>"),jQuery(".update_app_branding_message").html('<div class="update_app_branding_message_update"><i class="wpem-icon-checkmark"></i> Your preferred color for your app branding has been successfully saved.</div>'),"dark"==e.data.mode&&(jQuery("table#app-branding-color").hide(),jQuery("table#app-branding-color-dark").show())},error:function(e,a,r){jQuery(".wpem-branding-status").html('<div class="wpem-api-message error"><p>'+r+"</p></div>"),jQuery(".update_app_branding_message").html('<div class="update_app_branding_message_update"><i class="wpem-icon-cross"></i> Your preferred color for your app branding has not been successfully saved.</div>')},complete:function(e,a){}})},changeBrightness:function(e,a){var r=e.target.name,n=jQuery(e.target).parents("table").attr("id");jQuery.ajax({url:wpem_rest_api_admin.ajaxUrl,type:"POST",dataType:"HTML",data:{action:"change_brighness_color",color:a},success:function(e){const a=e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'");jQuery("#"+n+" tbody tr td#"+r).html(a)}})}}};jQuery(document).ready(function(e){WPEMRestAPIAdmin.init()});